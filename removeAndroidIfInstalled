#!/usr/bin/env bash

# If there is an AndroidManifest.xml file then it is a react-native CLI based project.  So look at it, if not skip it it was an expo project.
if [ -f "./android/app/src/main/AndroidManifest.xml" ]; then
    # Try to grab package from the manifest
    PACKAGE=$(grep -o 'package="[a-zA-Z0-9_.]*"' ./android/app/src/main/AndroidManifest.xml | head -1 | cut -d'"' -f2)

    # If manifest didnâ€™t have it, fallback to Kotlin/Java sources
    if [ -z "$PACKAGE" ]; then
        PACKAGE=$(grep -r -m1 '^package ' ./android/app/src/main/java ./android/app/src/main/kotlin 2>/dev/null | head -1 | awk '{print $2}')
    fi

    echo "Detected package: $PACKAGE"

    if [ -n "$PACKAGE" ]; then
        FOUND=$(adb shell pm list packages | grep "$PACKAGE")
        if [ -n "$FOUND" ]; then
            adb uninstall "$PACKAGE"
        fi
    else
        echo "Could not detect package name."
    fi
fi
